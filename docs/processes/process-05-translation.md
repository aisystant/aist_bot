# –ü—Ä–æ—Ü–µ—Å—Å P-05: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞

## –û–±–∑–æ—Ä

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ **13 –º–µ—Å—Ç–∞—Ö**. –ü—Ä–æ–ø—É—Å–∫ –ª—é–±–æ–≥–æ –∏–∑ –Ω–∏—Ö –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ —á–∞—Å—Ç–∏—á–Ω–æ–π –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.

## –ß–µ–∫-–ª–∏—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —è–∑—ã–∫–∞

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —è–∑—ã–∫–∞

| –§–∞–π–ª | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|------|-------------|
| `i18n/loader.py:31` | –î–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ —è–∑—ã–∫–∞ –≤ `SUPPORTED_LANGUAGES` |
| `i18n/loader.py:37` | –î–æ–±–∞–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –≤ `get_language_name()` |

```python
# i18n/loader.py
SUPPORTED_LANGUAGES = ['ru', 'en', 'es', 'fr', 'NEW']  # –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–¥

def get_language_name(lang: str) -> str:
    names = {
        'ru': '–†—É—Å—Å–∫–∏–π',
        'en': 'English',
        'es': 'Espa√±ol',
        'fr': 'Fran√ßais',
        'NEW': 'New Language'  # –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ
    }
```

### 2. UI –ø–µ—Ä–µ–≤–æ–¥—ã

| –§–∞–π–ª | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|------|-------------|
| `i18n/translations/{lang}.yaml` | –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ –≤—Å–µ—Ö –∫–ª—é—á–µ–π |

–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ `i18n/translations/ru.yaml` –∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏.
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã `{name}`, `{day}` –∏ —Ç.–¥. ‚Äî –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞—Ç—å—Å—è.

### 3. –ù–∞–∑–≤–∞–Ω–∏—è —Ç–µ–º –ú–∞—Ä–∞—Ñ–æ–Ω–∞

| –§–∞–π–ª | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|------|-------------|
| `knowledge_structure.yaml` | –î–æ–±–∞–≤–∏—Ç—å `title_{lang}` –¥–ª—è –≤—Å–µ—Ö 28 —Ç–µ–º |

```yaml
# –î–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã (28 —à—Ç—É–∫):
- id: "day-1-theory"
  title: "–ß–µ—Ç—ã—Ä–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è..."
  title_en: "Four States..."
  title_es: "Cuatro estados..."
  title_fr: "Quatre √©tats..."
  title_NEW: "New translation..."  # –¥–æ–±–∞–≤–∏—Ç—å
```

### 4. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (Claude API)

–î–æ–±–∞–≤–∏—Ç—å —è–∑—ã–∫ –≤–æ –≤—Å–µ —Å–ª–æ–≤–∞—Ä–∏ `lang_instruction`:

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—Ç |
|------|--------|-----------------|
| `bot.py` | ~840, ~940, ~1060 | 3 |
| `clients/claude.py` | ~150, ~250, ~350 | 3 |
| `engines/feed/planner.py` | ~45, ~395, ~545 | 3 |
| `engines/shared/question_handler.py` | ~290, ~405 | 2 |

```python
lang_instruction = {
    'ru': "–í–ê–ñ–ù–û: –ü–∏—à–∏ –í–°–Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ.",
    'en': "IMPORTANT: Write EVERYTHING in English.",
    'es': "IMPORTANTE: Escribe TODO en espa√±ol.",
    'fr': "IMPORTANT: √âcris TOUT en fran√ßais.",
    'NEW': "NEW INSTRUCTION..."  # –¥–æ–±–∞–≤–∏—Ç—å
}.get(lang, "IMPORTANT: Write EVERYTHING in English.")
```

### 5. Fallback —Ç–µ–º—ã –¥–ª—è –õ–µ–Ω—Ç—ã

| –§–∞–π–ª | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|------|-------------|
| `engines/feed/planner.py:192-304` | –î–æ–±–∞–≤–∏—Ç—å `fallback_topics['NEW']` |

```python
fallback_topics = {
    'ru': [...],
    'en': [...],
    'es': [...],
    'fr': [...],
    'NEW': [  # –¥–æ–±–∞–≤–∏—Ç—å 5 —Ç–µ–º
        {"title": "...", "why": "...", "keywords": [...]},
        ...
    ]
}
```

### 6. –ö–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ —è–∑—ã–∫–∞

| –§–∞–π–ª | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|------|-------------|
| `bot.py:1624` | –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ |

```python
# –ë—ã–ª–æ:
[InlineKeyboardButton(text="üåê Language (en, es, fr, ru)", ...)]
# –°—Ç–∞–ª–æ:
[InlineKeyboardButton(text="üåê Language (en, es, fr, NEW, ru)", ...)]
```

### 7. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π (State Machine)

–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥ –≤ `display_name` –¥–ª—è –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:

| –§–∞–π–ª | –ü—Ä–∏–º–µ—Ä |
|------|--------|
| `states/base.py` | `display_name = {..., 'NEW': '...'}` |
| `states/common/start.py` | |
| `states/common/error.py` | + –º–∞—Å—Å–∏–≤—ã –∫–Ω–æ–ø–æ–∫ |
| `states/common/mode_select.py` | + –º–∞—Å—Å–∏–≤—ã –∫–Ω–æ–ø–æ–∫ |
| `states/common/consultation.py` | |
| `states/feed/digest.py` | |
| `states/feed/topics.py` | |
| `states/workshops/marathon/lesson.py` | |
| `states/workshops/marathon/question.py` | |
| `states/workshops/marathon/bonus.py` | + –º–∞—Å—Å–∏–≤—ã –∫–Ω–æ–ø–æ–∫ |
| `states/workshops/marathon/task.py` | |

```python
display_name = {
    "ru": "–ù–∞—á–∞–ª–æ",
    "en": "Start",
    "es": "Inicio",
    "fr": "D√©marrage",
    "NEW": "..."  # –¥–æ–±–∞–≤–∏—Ç—å
}

# –î–ª—è –∫–Ω–æ–ø–æ–∫:
YES_BUTTONS = ["üöÄ –î–∞...", "üöÄ Yes...", "üöÄ S√≠...", "üöÄ Oui...", "üöÄ NEW..."]
```

### 8. –¢–µ—Å—Ç—ã

| –§–∞–π–ª | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|------|-------------|
| `tests/i18n/test_translations.py` | –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —è–∑—ã–∫–∞ |

–î–æ–±–∞–≤–∏—Ç—å:
- `test_{lang}_completeness` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- `test_placeholders_preserved_in_{lang}` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤
- `test_critical_key_exists_in_{lang}` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–ª—é—á–µ–π
- –û–±–Ω–æ–≤–∏—Ç—å `test_basic_translation` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É greeting
- –û–±–Ω–æ–≤–∏—Ç—å `test_stats_method` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å assert –¥–ª—è —è–∑—ã–∫–∞
- –û–±–Ω–æ–≤–∏—Ç—å `test_detect_supported_languages` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å assert

### 9. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

| –§–∞–π–ª | –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å |
|------|-------------|
| `i18n/loader.py:220` | –û–±–Ω–æ–≤–∏—Ç—å docstring —Ñ—É–Ω–∫—Ü–∏–∏ `t()` |
| `docs/data/tables.md` | –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —è–∑—ã–∫–æ–≤ –≤ –ø–æ–ª–µ `language` |

## –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** ‚Äî `i18n/loader.py`
2. **UI –ø–µ—Ä–µ–≤–æ–¥—ã** ‚Äî `i18n/translations/{lang}.yaml`
3. **–¢–µ–º—ã –ú–∞—Ä–∞—Ñ–æ–Ω–∞** ‚Äî `knowledge_structure.yaml`
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞** ‚Äî –≤—Å–µ `lang_instruction`
5. **Fallback —Ç–µ–º—ã** ‚Äî `engines/feed/planner.py`
6. **–ö–Ω–æ–ø–∫–∞ —è–∑—ã–∫–∞** ‚Äî `bot.py`
7. **State metadata** ‚Äî `states/**/*.py`
8. **–¢–µ—Å—Ç—ã** ‚Äî `tests/i18n/test_translations.py`
9. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** ‚Äî docstrings –∏ docs/

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —è–∑—ã–∫–∞:

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã i18n
pytest tests/i18n/ -v

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω–æ—Ç—É –ø–µ—Ä–µ–≤–æ–¥–æ–≤
python -m i18n.checker check --lang NEW

# Smoke test –±–æ—Ç–∞
python -c "from bot import dp, bot"
```

## –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

| –°–∏–º–ø—Ç–æ–º | –ü—Ä–∏—á–∏–Ω–∞ | –†–µ—à–µ–Ω–∏–µ |
|---------|---------|---------|
| UI –Ω–∞ –Ω–æ–≤–æ–º —è–∑—ã–∫–µ, –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º | –ü—Ä–æ–ø—É—â–µ–Ω `lang_instruction` | –î–æ–±–∞–≤–∏—Ç—å –≤–æ –≤—Å–µ 11 –º–µ—Å—Ç |
| –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º | –ü—Ä–æ–ø—É—â–µ–Ω `title_{lang}` | –î–æ–±–∞–≤–∏—Ç—å –≤ `knowledge_structure.yaml` |
| –Ø–∑—ã–∫ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è | –ù–µ—Ç –ø–æ–ª—è –≤ –ë–î | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `language` –≤ `db/models.py` |
| –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç | –ü—Ä–æ–ø—É—â–µ–Ω—ã —Ç–µ—Å—Ç—ã | –û–±–Ω–æ–≤–∏—Ç—å `test_translations.py` |

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- [–î–∞–Ω–Ω—ã–µ: —Ç–∞–±–ª–∏—Ü–∞ interns](../data/tables.md) ‚Äî –ø–æ–ª–µ `language`
- [–ü—Ä–æ—Ü–µ—Å—Å P-02: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞](process-02-content-generation.md) ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `lang_instruction`
